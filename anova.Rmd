---
title: "CS7200 Spring 25 Logic Grid Insights Project Normal Distribution ANOVA"
author: 'Kaylah Facey and Abdelrahman Madkour'
date: "2025"
output: html_document
---

 
```{r setup, include=FALSE}
#install and load packages here
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(data.table)
library(ggplot2)
# install.packages("remotes")
# remotes::install_github("easystats/report")
library(report)
# install.packages("multcomp")
library(multcomp)
set.seed(23)
library(broom)
```

#### RUN THIS AND VERIFY EVERYTHING APPEARS IN THE OUTPUT AS EXPECTED BEFORE YOU TURN IT IN

```{r}

true_order <- c(
  'SIMPLE_OR_SAME_CAT',
  'SIMPLE_OR_DIFF_CAT',
  'BEFORE_DIFF_CAT',
  'BEFORE_ONE_SPOT_NOINFO',
  'BEFORE_N_SPOTS_NOINFO',
  'TRANS_ABC_TRUE',
  'TRANS_ABC_FALSE',
  'BEFORE_N_SPOTS_SHIFT',
  'BEFORE_N_SPOTS_CROSSCHECK',
  'TRANS_SETS'
)

# Insights all have a small difference in mu (20s)
constant_delta <- list(
  SIMPLE_OR_SAME_CAT = 30,
  SIMPLE_OR_DIFF_CAT = 50,
  BEFORE_DIFF_CAT = 70,
  BEFORE_ONE_SPOT_NOINFO = 90,
  BEFORE_N_SPOTS_NOINFO = 110,
  TRANS_ABC_TRUE = 130,
  TRANS_ABC_FALSE = 150,
  BEFORE_N_SPOTS_SHIFT = 170,
  BEFORE_N_SPOTS_CROSSCHECK = 190,
  TRANS_SETS = 210
)

# Insights are grouped. Within the group the difference in mu is very small (5s) but between groups it is more pronounced (20s)
grouped_delta <- list(
  # Beginner
  SIMPLE_OR_SAME_CAT = 30,
  SIMPLE_OR_DIFF_CAT = 35,
  BEFORE_DIFF_CAT = 40,
  # Intermediate
  BEFORE_ONE_SPOT_NOINFO = 60,
  BEFORE_N_SPOTS_NOINFO = 65,
  TRANS_ABC_TRUE = 70,
  TRANS_ABC_FALSE = 75,
  # Expert
  BEFORE_N_SPOTS_SHIFT = 95,
  BEFORE_N_SPOTS_CROSSCHECK = 100,
  TRANS_SETS = 105
)

muss <- list(constant_delta, grouped_delta)

# Testing with different sds.
sds <- c(10, 30, 60)

# Testing with different numbers of replicates 
rs <- c(2, 5, 10, 15, 20)
```

```{r}
for (mus in muss) {
  for (sd in sds) {
    for (r in rs) {
      simdata<-data.frame(
        a = c(),
        b = c(),
        mu = c()
      );
      for (insight in names(mus)) {
        mu <- mus[insight]
        for (i in 1:r) {
          t <- rnorm(n = 1, mean = as.numeric(mu), sd = as.numeric(sd))
          simdata <- rbind(simdata,c(t, insight))
        }
      }
      mu_name = ""
      if (identical(mus, constant_delta)) {
        mu_name = "constant"
      }
      else if (identical(mus, grouped_delta)) {
        mu_name = "grouped"
      }
      colnames(simdata) <- c("Time", "Insight")
      simdata$Time <- as.numeric(simdata$Time)
      simdata$Insight <- as.factor(simdata$Insight)
      write.csv(simdata, str_interp("simdata_mu-${mu_name}_sd-${sd}_r-${r}"))
      
      true_mus <- unname(unlist(mus))
      true_upper <- true_mus + sd
      true_lower <- true_mus - sd
      
      true.df <- data.frame(Insight=names(mus), true.mu=true_mus, true.upper=true_upper, true.lower=true_lower)
      
      pdf(str_interp("simhistogram_mu-${mu_name}_sd-${sd}_r-${r}.pdf"))
      plot <- ggplot(simdata, aes(x=Time, color=Insight, fill = Insight)) + 
        geom_histogram(aes(y=after_stat(density)), position="identity", alpha=0.5, binwidth = 20) +
        geom_density(alpha=0.5) + 
        labs(x = str_interp("Time (mean=${mu}, sd=${sd}, r=${r})"))
      plot
      print(plot)
      dev.off()
      
      pdf(str_interp("simboxplot_mu-${mu_name}_sd-${sd}_r-${r}.pdf"))
      plot <- ggplot(simdata, aes(x=factor(Insight, level=true_order), y=Time, color=Insight)) + 
        geom_crossbar(data = true.df, aes(x=factor(Insight, level=true_order), y=true.mu, ymin=true.upper, ymax=true.lower), color="grey") +
        geom_jitter() +
        geom_boxplot(alpha = 0) +
        labs(y = "Time", x = str_interp("Insight (mean=${mu_name}, sd=${sd}, r=${r})"))
      plot
      print(plot)
      dev.off()
      
      print("--------------------------------")
      print(str_interp("mean=${mu_name}, sd=${sd}, r=${r}"))
      
      anova <- aov(Time ~ Insight,
        data = simdata
      )
      write.csv(tidy(anova), str_interp("simanova_mu-${mu_name}_sd-${sd}_r-${r}"))
      
      tukey <- glht(anova, linfct = mcp(Insight="Tukey"))
      write.csv(tidy(tukey), str_interp("simtukey_mu-${mu_name}_sd-${sd}_r-${r}"))
      
      print("--------------------------------")
    }
  }
}
```


#### Additional formatting guidelines: 

For questions where you need to print formulas, please use this formatting: 
$$
y = b_0 + b_1X
$$


how to print a vector:
$$
\begin{bmatrix}
item \\ 
item \\
item
\end{bmatrix}
$$

how to print a matrix:
$$
\begin{bmatrix}
item & item & item\\
item & item & item\\
item & item & item\\
\end{bmatrix}
$$

For questions where you need to print plots, please use clear formatting for title and axes labels (note: you don't have to use ggplot, you can use base R for plotting too).
    
  
Example scatter plot:
```{r}
data(iris)
ggplot(iris) + aes(Petal.Length,Sepal.Length,color= Species) +
  geom_point() + theme_bw() + 
  ggtitle("Relationship between petal and sepal length in iris flower species") + 
  labs(x="Petal length (cm)", y="Sepal length (cm)")

```
